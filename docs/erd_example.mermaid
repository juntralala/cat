erDiagram
    USERS ||--o{ TRANSACTIONS : creates
    USERS ||--o{ ACTIVITY_LOGS : performs
    USERS {
        int id PK
        string username
        string email
        string password_hash
        string full_name
        string role
        timestamp created_at
        timestamp updated_at
    }

    CATEGORIES ||--o{ PRODUCTS : contains
    CATEGORIES {
        int id PK
        string name
        string description
        timestamp created_at
    }

    PRODUCTS ||--o{ TRANSACTION_ITEMS : "has items in"
    PRODUCTS ||--o{ STOCK_HISTORY : tracks
    PRODUCTS {
        int id PK
        int category_id FK
        string sku
        string name
        string description
        int current_stock
        int min_stock
        string unit
        decimal price
        timestamp created_at
        timestamp updated_at
    }

    TRANSACTIONS ||--o{ TRANSACTION_ITEMS : contains
    TRANSACTIONS ||--o{ ACTIVITY_LOGS : logged_in
    TRANSACTIONS {
        int id PK
        string transaction_code
        string type
        int user_id FK
        int supplier_id FK
        int customer_id FK
        string status
        text notes
        int reverted_from FK
        timestamp transaction_date
        timestamp created_at
        timestamp updated_at
    }

    TRANSACTION_ITEMS ||--o{ STOCK_HISTORY : creates
    TRANSACTION_ITEMS {
        int id PK
        int transaction_id FK
        int product_id FK
        int quantity
        decimal unit_price
        decimal subtotal
        timestamp created_at
    }

    SUPPLIERS ||--o{ TRANSACTIONS : supplies
    SUPPLIERS {
        int id PK
        string name
        string contact_person
        string phone
        string email
        text address
        timestamp created_at
        timestamp updated_at
    }

    CUSTOMERS ||--o{ TRANSACTIONS : receives
    CUSTOMERS {
        int id PK
        string name
        string contact_person
        string phone
        string email
        text address
        timestamp created_at
        timestamp updated_at
    }

    STOCK_HISTORY {
        int id PK
        int product_id FK
        int transaction_item_id FK
        string type
        int quantity_before
        int quantity_change
        int quantity_after
        string reference_code
        timestamp created_at
    }

    ACTIVITY_LOGS {
        int id PK
        int user_id FK
        int transaction_id FK
        string action
        string entity_type
        int entity_id
        text description
        json old_data
        json new_data
        string ip_address
        timestamp created_at
    }